tags:
  - name: Order
    description: Order History and Detail API

paths:
  /api/orders:
    get:
      tags:
        - Order
      summary: Ambil riwayat pesanan user
      description: Mengambil semua daftar pesanan milik user yang sedang login dengan ringkasan item (preview).
      security:
        - bearerAuth: []
      responses:
        200:
          description: get all order success
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "get all order success"
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/OrderSummary"
        400:
          description: Bad Request
        401:
          description: Unauthorized

  /api/orders/{id}:
    get:
      tags:
        - Order
      summary: Ambil detail pesanan berdasarkan ID
      description: Mengambil informasi lengkap pesanan termasuk alamat, kurir dummy, daftar item, dan rincian harga.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID Pesanan (Order ID)
      responses:
        200:
          description: get detail order success
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "get detail order success"
                  data:
                    $ref: "#/components/schemas/OrderDetail"
        404:
          description: Order tidak ditemukan

  /api/orders/{id}/complete:
    patch:
      tags:
        - Order
      summary: Selesaikan pesanan (Konfirmasi Terima)
      description: Mengubah status order menjadi 'selesai'. Hanya bisa dilakukan jika status saat ini adalah 'dikirim'.
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        200:
          description: update statu complate order succes
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "update statu complate order succes"
                  data:
                    $ref: "#/components/schemas/OrderRaw"
        404:
          description: Order tidak ditemukan atau status belum 'dikirim'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    OrderSummary:
      type: object
      properties:
        id:
          type: string
        created_at:
          type: string
          format: date-time
        status:
          type: string
          enum: [pembayaran, diproses, dikirim, selesai, dibatalkan]
        totalHarga:
          type: integer
        totalItem:
          type: integer
        preview:
          type: object
          nullable: true
          properties:
            nama:
              type: string
              example: "Aglaonema +2 lainnya"
            gambar:
              type: string
              example: "plant-image.jpg"

    OrderDetail:
      type: object
      properties:
        id:
          type: string
        status:
          type: string
        created_at:
          type: string
        paymentMethod:
          type: string
        shipping:
          type: object
          properties:
            fullName:
              type: string
            phone:
              type: string
            address:
              type: string
              example: "Jl. Merdeka No 1, Jakarta, DKI Jakarta 12345"
            courier:
              type: object
              properties:
                name:
                  type: string
                resi:
                  type: string
                estimate:
                  type: string
        items:
          type: array
          items:
            $ref: "#/components/schemas/OrderItem"
        summary:
          type: object
          properties:
            subtotal:
              type: integer
            ongkir:
              type: integer
            diskonOngkir:
              type: integer
            total:
              type: integer

    OrderItem:
      type: object
      properties:
        id:
          type: string
        orderId:
          type: string
        plantId:
          type: string
        nama:
          type: string
        harga:
          type: integer
        qty:
          type: integer
        gambar:
          type: string

    OrderRaw:
      type: object
      properties:
        id:
          type: string
        status:
          type: string
        totalHarga:
          type: integer
